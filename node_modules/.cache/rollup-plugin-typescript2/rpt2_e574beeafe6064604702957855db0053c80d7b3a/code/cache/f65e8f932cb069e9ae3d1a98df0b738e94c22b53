{"code":"import { __awaiter } from \"tslib\";\nimport { Plugin } from \"obsidian\";\nexport default class FullCalendarColorAddon extends Plugin {\n    onload() {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log(\"Full Calendar Color Addon loaded\");\n            let config = {};\n            let refreshInterval = 30000; // fallback по умолчанию\n            try {\n                const raw = yield this.app.vault.adapter.read(`${this.app.vault.configDir}/plugins/${this.manifest.id}/config.json`);\n                config = JSON.parse(raw);\n                // Забираем refreshInterval, если указан\n                if (\"refreshInterval\" in config) {\n                    const rawInterval = Number(config[\"refreshInterval\"]);\n                    if (!isNaN(rawInterval) && rawInterval >= 1000) {\n                        refreshInterval = rawInterval;\n                    }\n                    delete config[\"refreshInterval\"]; // Удалим, чтобы не обрабатывался как keyword\n                }\n            }\n            catch (err) {\n                console.error(\"Failed to load config:\", err);\n                return;\n            }\n            function classifyEvents() {\n                document.querySelectorAll(\"a.fc-timegrid-event\").forEach((el) => {\n                    const titleEl = el.querySelector(\".fc-event-title\");\n                    const title = ((titleEl === null || titleEl === void 0 ? void 0 : titleEl.textContent) || \"\").toLowerCase();\n                    for (const keyword in config) {\n                        if (title.includes(keyword.toLowerCase())) {\n                            const color = config[keyword];\n                            el.setAttribute(\"data-type\", keyword);\n                            el.style.setProperty(\"background-color\", color, \"important\");\n                            el.style.setProperty(\"border-color\", \"white\", \"important\");\n                            break;\n                        }\n                    }\n                });\n            }\n            // Слежение за DOM-обновлениями\n            const observer = new MutationObserver(classifyEvents);\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n            // Повторная перекраска (на случай отложенной отрисовки)\n            let attempts = 0;\n            const interval = setInterval(() => {\n                classifyEvents();\n                if (++attempts > 20)\n                    clearInterval(interval);\n            }, 500);\n            // Обновление событий Full Calendar с интервалом из конфига\n            this.registerInterval(setInterval(() => {\n                var _a;\n                // @ts-ignore\n                const plugin = app.plugins.plugins[\"obsidian-full-calendar\"];\n                (_a = plugin === null || plugin === void 0 ? void 0 : plugin.cache) === null || _a === void 0 ? void 0 : _a.revalidateRemoteCalendars(true);\n            }, refreshInterval));\n            console.log(`Revalidation every ${refreshInterval}ms`);\n        });\n    }\n}\n","references":["C:/obsidian-full-calendar-color-addon/node_modules/obsidian/obsidian.d.ts"]}
